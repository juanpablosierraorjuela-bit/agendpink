<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agenda Pink Bliss - Administraci칩n</title>
    <!-- Tailwind CSS y Lucide Icons -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #fdf2f8; }
        /* Estilos de input responsivos y con focus */
        .app-input {
            @apply w-full pl-10 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:border-pink-500 focus:ring-2 focus:ring-pink-200 transition-all font-medium text-gray-700;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- Contenedor Principal Adaptable -->
    <div class="bg-white rounded-3xl shadow-2xl w-full max-w-5xl overflow-hidden shadow-pink-200/50">
        
        <!-- Pesta침as de Navegaci칩n -->
        <div class="flex border-b border-pink-200">
            <button id="tab-agenda" class="py-4 px-6 text-sm font-extrabold border-b-2 transition duration-150 text-pink-600 border-pink-600">
                <i data-lucide="calendar-heart" class="inline-block w-4 h-4 mr-1"></i> Agendar Cita
            </button>
            <button id="tab-admin" class="py-4 px-6 text-sm font-bold border-b-2 border-transparent text-gray-500 hover:text-pink-600 hover:border-pink-300">
                <i data-lucide="settings" class="inline-block w-4 h-4 mr-1"></i> Admin. Empleados y Horarios
            </button>
        </div>

        <!-- Contenido -->
        <div class="p-6 md:p-10">

            <header class="text-center mb-6">
                <h1 class="text-3xl font-extrabold text-gray-800">Pink Bliss Agenda</h1>
            </header>

            <!-- Mensaje de Estado Global -->
            <div id="mensaje-estado" class="hidden p-3 mb-5 rounded-xl text-center font-bold text-sm"></div>

            <!-- SECCI칍N 1: AGENDA DE CITAS -->
            <div id="content-agenda">
                <form id="form-cita" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        
                        <!-- Datos Cliente -->
                        <div class="space-y-4">
                            <h3 class="text-xl font-bold text-gray-700 border-b border-pink-100 pb-2">Tus Datos</h3>
                            <div>
                                <label class="text-xs font-bold text-gray-500 uppercase ml-1">Tu Nombre</label>
                                <div class="relative mt-1">
                                    <i data-lucide="user" class="absolute left-3 top-3.5 w-5 h-5 text-gray-400"></i>
                                    <input type="text" id="nombre" required placeholder="Ej: Ana Mar칤a" class="app-input">
                                </div>
                            </div>
                            <div>
                                <label class="text-xs font-bold text-gray-500 uppercase ml-1">WhatsApp / Telegram</label>
                                <div class="relative mt-1">
                                    <i data-lucide="smartphone" class="absolute left-3 top-3.5 w-5 h-5 text-gray-400"></i>
                                    <input type="tel" id="contacto" required placeholder="Ej: 300 123 4567" class="app-input">
                                </div>
                            </div>
                        </div>

                        <!-- Detalles de la Cita -->
                        <div class="space-y-4">
                            <h3 class="text-xl font-bold text-gray-700 border-b border-pink-100 pb-2">Detalles</h3>
                            
                            <!-- Servicio -->
                            <div>
                                <label class="text-xs font-bold text-gray-500 uppercase ml-1">Servicio</label>
                                <div class="relative mt-1">
                                    <!-- Este select se llena con la lista fija de servicios -->
                                    <select id="servicio" class="app-input appearance-none cursor-pointer">
                                        <option value="Corte de Cabello (60)">Corte de Cabello (60 min)</option>
                                        <option value="Manicure Spa (90)">Manicure Spa (90 min)</option>
                                        <option value="Tinte & Color (120)">Tinte & Color (120 min)</option>
                                        <option value="Cepillado (45)">Cepillado (45 min)</option>
                                    </select>
                                    <i data-lucide="chevron-down" class="absolute right-3 top-3.5 w-4 h-4 text-gray-400 pointer-events-none"></i>
                                </div>
                            </div>

                            <!-- Empleado (El core de la solicitud) -->
                            <div>
                                <label class="text-xs font-bold text-gray-500 uppercase ml-1">Estilista Favorito</label>
                                <div class="relative mt-1">
                                    <select id="empleado" required class="app-input appearance-none cursor-pointer">
                                        <option value="">Cargando Estilistas...</option>
                                    </select>
                                    <i data-lucide="chevron-down" class="absolute right-3 top-3.5 w-4 h-4 text-gray-400 pointer-events-none"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Fecha y Hora (Abajo) -->
                        <div class="col-span-1 md:col-span-2 grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-xs font-bold text-gray-500 uppercase ml-1">Fecha</label>
                                <input type="date" id="fecha" required class="app-input">
                            </div>
                            <div>
                                <label class="text-xs font-bold text-gray-500 uppercase ml-1">Hora</label>
                                <input type="time" id="hora" required class="app-input">
                            </div>
                        </div>

                    </div>
                    
                    <!-- Bot칩n de Acci칩n -->
                    <button type="submit" id="btn-agendar" class="w-full bg-gradient-to-r from-pink-600 to-pink-500 text-white font-bold py-4 rounded-xl shadow-lg mt-6 flex items-center justify-center gap-2 transition hover:scale-[1.01]">
                        <span>Confirmar Reserva</span>
                        <i data-lucide="send" class="w-5 h-5"></i>
                    </button>
                </form>
            </div> <!-- Fin content-agenda -->


            <!-- SECCI칍N 2: ADMINISTRACI칍N DE EMPLEADOS -->
            <div id="content-admin" class="hidden">
                <h3 class="text-xl font-bold text-gray-700 border-b border-pink-100 pb-2 mb-4">Gesti칩n de Personal</h3>
                <p class="text-sm text-gray-600 mb-4">Los datos de los estilistas se guardan en tu navegador (`localStorage`) para simplicidad.</p>

                <div id="employee-list" class="space-y-3 mb-6">
                    <!-- Lista de empleados se inserta aqu칤 -->
                </div>

                <button id="add-employee-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg flex items-center transition">
                    <i data-lucide="user-plus" class="w-5 h-5 mr-2"></i> A침adir Nuevo Estilista
                </button>
            </div> <!-- Fin content-admin -->

        </div> <!-- Fin p-6 md:p-10 -->
    </div> <!-- Fin contenedor principal -->


    <!-- Modal (Ventana Emergente) para Crear/Editar Empleados -->
    <div id="employee-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden p-4 z-50">
        <div class="bg-white rounded-xl p-6 w-full max-w-sm shadow-2xl">
            <h3 class="text-xl font-bold text-pink-600 mb-4" id="modal-title">A침adir Nuevo Estilista</h3>
            <form id="employee-form" class="space-y-4">
                <input type="hidden" id="employee-id">
                <div>
                    <label class="block text-sm font-bold text-gray-600 mb-1">Nombre Completo</label>
                    <input type="text" id="modal-name" required class="app-input pl-4 pr-4">
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-600 mb-1">Horario Laboral (Ej: L-V 9am-5pm)</label>
                    <textarea id="modal-schedule" required class="app-input pl-4 pr-4"></textarea>
                </div>
                <div class="flex justify-end space-x-3">
                    <button type="button" id="close-modal-btn" class="bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg transition hover:bg-gray-300">Cancelar</button>
                    <button type="submit" class="bg-pink-600 text-white font-bold py-2 px-4 rounded-lg transition hover:bg-pink-700">Guardar Estilista</button>
                </div>
            </form>
        </div>
    </div>


    <!-- L칩gica JavaScript para la administraci칩n y agendamiento -->
    <script>
        // --- CONFIGURACI칍N DE CONEXI칍N (Render URL) ---
        const BACKEND_URL = 'https://agenda-backend-735v.onrender.com'; 
        // ------------------------------------------------------------------
        
        // --- Variables de Estado ---
        let employees = JSON.parse(localStorage.getItem('pinkBlissEmployees')) || [];

        // --- UTILS ---
        function showMessage(texto, tipo) {
            const div = document.getElementById('mensaje-estado');
            div.textContent = texto;
            div.className = `p-3 mb-5 rounded-xl text-center font-bold text-sm ${
                tipo === 'exito' ? 'bg-green-100 text-green-700 border border-green-200' : 
                'bg-red-100 text-red-700 border border-red-200'
            }`;
            div.classList.remove('hidden');
        }

        // --- L칍GICA DE EMPLEADOS (LocalStorage) ---

        function saveEmployeesToLocalStorage() {
            localStorage.setItem('pinkBlissEmployees', JSON.stringify(employees));
        }

        function renderEmployeeList() {
            const listContainer = document.getElementById('employee-list');
            listContainer.innerHTML = '';
            if (employees.length === 0) {
                listContainer.innerHTML = '<p class="text-gray-500 italic text-center p-4">A칰n no hay estilistas. A침ade uno para empezar.</p>';
                return;
            }

            employees.forEach(emp => {
                const item = document.createElement('div');
                item.className = 'bg-white p-4 rounded-xl border border-pink-100 shadow-sm flex justify-between items-center';
                item.innerHTML = `
                    <div>
                        <p class="font-bold text-gray-800">${emp.name}</p>
                        <p class="text-xs text-gray-500">Horario: ${emp.schedule}</p>
                    </div>
                    <div class="space-x-2">
                        <button data-id="${emp.id}" class="edit-employee-btn text-blue-500 hover:text-blue-700"><i data-lucide="pencil" class="w-4 h-4"></i></button>
                        <button data-id="${emp.id}" class="delete-employee-btn text-red-500 hover:text-red-700"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                    </div>
                `;
                listContainer.appendChild(item);
            });
            lucide.createIcons();
        }

        function renderEmployeeDropdown() {
            const select = document.getElementById('empleado');
            select.innerHTML = '';
            if (employees.length === 0) {
                select.innerHTML = '<option value="">--- Ning칰n Estilista Disponible ---</option>';
            } else {
                select.innerHTML = '<option value="" disabled selected>--- Escoge tu Estilista ---</option>';
                employees.forEach(emp => {
                    const option = document.createElement('option');
                    option.value = emp.id;
                    option.textContent = emp.name;
                    select.appendChild(option);
                });
            }
        }

        // --- L칍GICA DEL FORMULARIO DE EMPLEADOS ---
        document.getElementById('employee-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const id = document.getElementById('employee-id').value;
            const name = document.getElementById('modal-name').value;
            const schedule = document.getElementById('modal-schedule').value;
            
            if (id) {
                // Editar existente
                const index = employees.findIndex(emp => emp.id === id);
                if (index !== -1) {
                    employees[index].name = name;
                    employees[index].schedule = schedule;
                    showMessage(`Estilista ${name} actualizado.`, 'exito');
                }
            } else {
                // Crear nuevo
                const newEmployee = {
                    id: crypto.randomUUID(),
                    name: name,
                    schedule: schedule
                };
                employees.push(newEmployee);
                showMessage(`Estilista ${name} a침adido.`, 'exito');
            }

            saveEmployeesToLocalStorage();
            renderEmployeeList();
            renderEmployeeDropdown();
            document.getElementById('employee-modal').classList.add('hidden');
        });

        // --- L칍GICA DEL AGENDAMIENTO ---
        document.getElementById('form-cita').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btn-agendar');
            const originalText = btn.innerHTML;
            
            btn.innerHTML = `<i data-lucide="loader-2" class="w-5 h-5 animate-spin"></i> Enviando...`;
            lucide.createIcons();
            btn.disabled = true;

            const selectedEmployee = employees.find(emp => emp.id === document.getElementById('empleado').value);
            const employeeName = selectedEmployee ? selectedEmployee.name : "Estilista No Seleccionado";

            const datos = {
                clientName: document.getElementById('nombre').value,
                clientContact: document.getElementById('contacto').value,
                serviceName: document.getElementById('servicio').value.split(' (')[0], // Limpiar (min)
                employeeName: employeeName,
                formattedTime: `${document.getElementById('fecha').value} a las ${document.getElementById('hora').value}`
            };

            try {
                const respuesta = await fetch(`${BACKEND_URL}/send-telegram`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(datos)
                });

                if (respuesta.ok) {
                    showMessage("춰Reserva exitosa! Revisa tu Telegram. 游눘", 'exito');
                    document.getElementById('form-cita').reset();
                } else {
                    const error = await respuesta.json();
                    throw new Error(error.message || "Error desconocido");
                }
            } catch (error) {
                console.error(error);
                showMessage(`Error: Fall칩 la conexi칩n con el servidor. 쮼st치 Render activo?`, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        });


        // --- EVENTOS Y ARRANQUE ---
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            renderEmployeeList();
            renderEmployeeDropdown();
            document.getElementById('fecha').min = new Date().toISOString().split('T')[0];

            // 1. Configurar Pesta침as
            document.getElementById('tab-agenda').addEventListener('click', () => {
                document.getElementById('content-agenda').classList.remove('hidden');
                document.getElementById('content-admin').classList.add('hidden');
                document.getElementById('tab-agenda').classList.add('text-pink-600', 'border-pink-600');
                document.getElementById('tab-admin').classList.remove('text-pink-600', 'border-pink-600');
                document.getElementById('tab-admin').classList.add('text-gray-500');
                showMessage('', ''); // Limpiar mensajes
            });
            document.getElementById('tab-admin').addEventListener('click', () => {
                document.getElementById('content-agenda').classList.add('hidden');
                document.getElementById('content-admin').classList.remove('hidden');
                document.getElementById('tab-admin').classList.add('text-pink-600', 'border-pink-600');
                document.getElementById('tab-agenda').classList.remove('text-pink-600', 'border-pink-600');
                document.getElementById('tab-agenda').classList.add('text-gray-500');
                showMessage('', ''); // Limpiar mensajes
            });

            // 2. Eventos del Modal
            document.getElementById('add-employee-btn').addEventListener('click', () => {
                document.getElementById('employee-id').value = '';
                document.getElementById('modal-title').textContent = 'A침adir Nuevo Estilista';
                document.getElementById('employee-form').reset();
                document.getElementById('employee-modal').classList.remove('hidden');
            });
            document.getElementById('close-modal-btn').addEventListener('click', () => {
                document.getElementById('employee-modal').classList.add('hidden');
            });

            // 3. Delegaci칩n de Eventos para botones Editar/Eliminar
            document.getElementById('employee-list').addEventListener('click', (e) => {
                const target = e.target.closest('button');
                if (!target) return;

                const id = target.dataset.id;
                
                if (target.classList.contains('edit-employee-btn')) {
                    const emp = employees.find(e => e.id === id);
                    if (emp) {
                        document.getElementById('employee-id').value = emp.id;
                        document.getElementById('modal-name').value = emp.name;
                        document.getElementById('modal-schedule').value = emp.schedule;
                        document.getElementById('modal-title').textContent = `Editar a ${emp.name}`;
                        document.getElementById('employee-modal').classList.remove('hidden');
                    }
                } else if (target.classList.contains('delete-employee-btn')) {
                    if (confirm("쮼st치s seguro de eliminar a este estilista?")) {
                        employees = employees.filter(emp => emp.id !== id);
                        saveEmployeesToLocalStorage();
                        renderEmployeeList();
                        renderEmployeeDropdown();
                        showMessage('Estilista eliminado.', 'exito');
                    }
                }
            });
        });
    </script>
</body>
</html>